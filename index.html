<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DÃ©gg Wolof</title>
<link rel="icon" type="image/jpeg" href="flag.png">
<style>
* {margin:0; padding:0; box-sizing:border-box;}
body {
    font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background:linear-gradient(135deg,#373675 0%,#171631 100%);
    min-height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    padding:20px;
    color:white;
}
.container {max-width:700px;width:100%;}
.top-bar {
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:20px;
    max-width:600px;
    margin-left:auto;
    margin-right:auto;
}
.progress {font-size:16px; text-align:right; flex:1;}
button {
    padding:8px 14px;
    font-size:13px;
    border:none;
    border-radius:6px;
    cursor:pointer;
    font-weight:400;
    color:white;
    opacity:0.8;
    background:#5b6bbf;
}
button:hover{opacity:1;}
button:disabled{opacity:0.3;}

.welcome-screen {
    text-align:center;
    padding:40px 20px;
    max-width:500px;
    margin:0 auto;
}
.welcome-screen h1 {
    font-size:32px;
    margin-bottom:20px;
}
.welcome-screen p {
    font-size:16px;
    margin-bottom:30px;
    opacity:0.9;
}
.welcome-buttons {
    display:flex;
    flex-direction:column;
    gap:15px;
    max-width:375px;
    margin:0 auto;
}
.welcome-buttons button {
    padding:15px 20px;
    font-size:18px;
    width:100%;
}
.primary-btn {
    background:#10888c;
}
.secondary-btn {
    background:#5c76eb;
}

.card-container {
    width: 100%;
    max-width: 600px;
    margin: 40px auto;
    height: 350px;
    perspective: 1000px;
    display: flex;
    justify-content: center;
    align-items: center;
}

.card {
    width: 100%;
    height: 100%;
    border-radius:15px;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    font-size:28px;
    font-weight:600;
    user-select:none;
    cursor:pointer;
    transition: transform 0.6s;
    transform-style: preserve-3d;
    position:relative;
}

.card-face {
    width:100%;
    height:100%;
    backface-visibility:hidden;
    border-radius:15px;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    position:absolute;
    padding:20px;
}

.card-front {
    background:rgb(224, 224, 224);
    color:#000;
}

.card-back {
    background: #c9dfe0;
    color: #000;
    transform: rotateY(180deg);
    padding-bottom:80px;
}

.card-face > div:last-child {
    padding: 0 20px;
    text-align: center;
}

.direction-badge {
    position:absolute;
    top:10px;
    left:10px;
    padding:6px 12px;
    background:#667eea;
    color:white;
    border-radius:20px;
    font-size:12px;
    font-weight:600;
}

.buttons {
    position: absolute;
    left: 20px;
    right: 20px;
    bottom: 18px;
    display: flex;
    gap: 12px;
    justify-content: center;
    pointer-events: auto;
}

.got-btn, .missed-btn {
    font-size:16px;
    padding:12px 0;
    width:120px;
}
.got-btn {background:#108c63;}
.missed-btn {background:#992775;}
.got-btn:hover, .missed-btn:hover{transform:scale(1.05);}

.save-reminder {
    position: absolute;
    top: 50px;
    left: 0;
    background: #667eea;
    color: white;
    padding: 15px 20px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    max-width: 280px;
    font-size: 14px;
    z-index: 1000;
    animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
    from {
        transform: translateY(-20px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.save-reminder-close {
    position: absolute;
    top: 8px;
    right: 8px;
    background: transparent;
    border: none;
    color: white;
    font-size: 18px;
    cursor: pointer;
    padding: 0;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0.8;
}

.save-reminder-close:hover {
    opacity: 1;
    background: rgba(255,255,255,0.1);
    border-radius: 4px;
}

</style>
</head>
<body>
<div class="container">
    <div class="top-bar" id="topBar" style="display:none;">
        <div>
            <button id="exportBtn" onclick="exportProgress()">Save Progress</button>
        </div>
        <div class="progress" id="progress">Mastered: 0 / 0</div>
    </div>
    <div id="content">
        <div class="welcome-screen">
            <h1>DÃ©gg Wolof</h1>
            <p>Learn Wolof and track your progress with...flashcards!</p>
            <div class="welcome-buttons">
                <button class="secondary-btn" onclick="continueLearning()">Import flashcards - continue learning</button>
                <button class="primary-btn" onclick="firstTimeUser()">Download flashcards - first-time user</button>
            </div>
        </div>
    </div>
</div>

<script>
let vocabulary = [];
let wolofQueue = [];
let englishQueue = [];
let currentCard = null;
let showingWolof = true;
let isFlipped = false;
let loadedFileHandle = null;
let isFirstTimeUser = false;

async function firstTimeUser() {
    try {
        const response = await fetch('wolof_vocab.json');
        const data = await response.json();
        
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'wolof_vocab.json';
        a.click();
        URL.revokeObjectURL(url);
        
        isFirstTimeUser = true;
        
        document.getElementById('content').innerHTML = `
            <div class="welcome-screen">
                <h1>âœ… Downloaded!</h1>
                <p>Your vocabulary file has been downloaded. Keep this file safe - it will track your progress.</p>
                <p style="margin-top:20px;">When you're ready to start learning, click the button below and select the file you just downloaded.</p>
                <div class="welcome-buttons">
                    <button class="primary-btn" onclick="continueLearning()">Select wolof_vocab file to start!</button>
                </div>
            </div>
        `;
    } catch (error) {
        alert('Please download the raw file from https://github.com/philshams/DeggWolof/blob/main/wolof_vocab.json');
    }
}

function continueLearning() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    input.onchange = async e => {
        const file = input.files[0];
        if (file) {
            loadedFileHandle = file;
            const text = await file.text();
            const data = JSON.parse(text);
            processVocabularyData(data);
            document.getElementById('topBar').style.display = 'flex';
            
            if (isFirstTimeUser) {
                showSaveReminder();
            }
            
            renderCard();
        }
    };
    input.click();
}

function showSaveReminder() {
    const reminder = document.createElement('div');
    reminder.className = 'save-reminder';
    reminder.id = 'saveReminder';
    reminder.innerHTML = `
        <button class="save-reminder-close" onclick="closeSaveReminder()">Ã—</button>
        <div style="padding-right: 20px;">
            <strong>ðŸ’¾ Don't forget!</strong><br>
            Before you exit, make sure to save your progress to keep track of the phrases you've gotten correct.
        </div>
    `;
    document.body.appendChild(reminder);
}

function closeSaveReminder() {
    const reminder = document.getElementById('saveReminder');
    if (reminder) {
        reminder.remove();
    }
}

function processVocabularyData(data) {
    vocabulary = data.vocabulary;
    
    wolofQueue = [...vocabulary];
    englishQueue = [...vocabulary];
    shuffle(wolofQueue);
    shuffle(englishQueue);
}

function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}

function updateProgress() {
    const learned = vocabulary.filter(c => c.correctWoToEn && c.correctEnToWo).length;
    document.getElementById('progress').textContent = `Mastered: ${learned} / ${vocabulary.length}`;
}

function getNextCard() {
    showingWolof = Math.random() < 0.5;
    let queue = showingWolof ? wolofQueue : englishQueue;
    if (queue.length === 0) {
        queue = showingWolof ? englishQueue : wolofQueue;
        showingWolof = !showingWolof;
        if (queue.length === 0) return null;
    }
    currentCard = queue[0];
    return currentCard;
}

function renderCard() {
    const card = getNextCard();
    const content = document.getElementById('content');
    if (!card) {
        content.innerHTML = `<div style="text-align:center;padding:40px;">
            <h2>ðŸŽ‰ Congratulations!</h2>
            <p>All cards mastered!</p>
            <button onclick="exportProgress()" style="margin-top:20px;padding:12px 24px;font-size:16px;">Save Progress</button>
        </div>`;
        return;
    }
    const displayText = showingWolof ? card.wolof : card.english;
    const direction = showingWolof ? "Wolof â†’ English" : "English â†’ Wolof";
    const levelBadge = card.level ? `<span style="position:absolute;top:10px;right:10px;padding:6px 12px;background:#9ca3af;color:white;border-radius:20px;font-size:12px;font-weight:600;">${card.level}</span>` : '';
    content.innerHTML = `<div class="card-container">
                <div class="card" id="card" onclick="flipCard()">
                    <div class="card-face card-front">
                        <div class="direction-badge">${direction}</div>
                        ${levelBadge}
                        <div id="cardMain">${displayText}</div>
                    </div>
                    <div class="card-face card-back">
                        <div class="direction-badge">${direction}</div>
                        ${levelBadge}
                        <div id="cardBack">${showingWolof ? card.english : card.wolof}</div>
                        <div class="buttons">
                            <button class="got-btn" onclick="event.stopPropagation(); markCorrect()">Got it</button>
                            <button class="missed-btn" onclick="event.stopPropagation(); markWrong()">Missed it</button>
                        </div>
                    </div>
                </div>
            </div>`;
    isFlipped = false;
    updateProgress();
}

function flipCard() {
    const cardDiv = document.getElementById('card');
    cardDiv.style.transform = isFlipped ? "rotateY(0deg)" : "rotateY(180deg)";
    isFlipped = !isFlipped;
}

function markCorrect() {
    if (showingWolof) currentCard.correctWoToEn = true;
    else currentCard.correctEnToWo = true;
    if (showingWolof) { wolofQueue.push(wolofQueue.shift()); } else { englishQueue.push(englishQueue.shift()); }
    renderCard();
}

function markWrong() {
    currentCard.correctWoToEn = false;
    currentCard.correctEnToWo = false;
    if (showingWolof) { wolofQueue.push(wolofQueue.shift()); } else { englishQueue.push(englishQueue.shift()); }
    renderCard();
}

async function exportProgress() {
    const data = {
        vocabulary: vocabulary
    };
    
    if (window.showSaveFilePicker) {
        try {
            const options = {
                types: [{
                    description: 'JSON Files',
                    accept: { 'application/json': ['.json'] }
                }],
                suggestedName: loadedFileHandle ? loadedFileHandle.name : 'wolof_vocab.json'
            };
            const handle = await window.showSaveFilePicker(options);
            const writable = await handle.createWritable();
            await writable.write(JSON.stringify(data, null, 2));
            await writable.close();
            alert('Progress saved successfully!');
        } catch (err) {
            if (err.name !== 'AbortError') {
                console.error('Save failed:', err);
            }
        }
    } else {
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = loadedFileHandle ? loadedFileHandle.name : 'wolof_vocab.json';
        a.click();
        URL.revokeObjectURL(url);
    }
}
</script>
</body>
</html>